# Based on paper by Rezansoff et al., 2019
# https://www.sciencedirect.com/science/article/pii/S002075191930205X#!
# The confounding effects of high genetic diversity on the determination and interpretation of differential gene expression analysis in the parasitic nematode Haemonchus contortus


# First, to get WGS data and align to ISE genome



# Next, to create an mpileup file of SNPs within CDS of genes



# To determine the SNP rate per CDS
# Want to have the total number of SNPs with AF >40% cf ref genome
# And the total length of the CDS.

# To get the total length of the CDS:
# Use the gff3 file.

gunzip haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3.gz

##gff-version 3
##sequence-region hcontortus_chr4_Celeg_TT_arrow_pilon 1 51826579
# Gene gene:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       gene    7550    13746   .       -       .       ID=gene:HCON_00095840;Name=HCON_00095840;biotype=protein_coding;previous_stabl
e_id=HCOI00362600
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       mRNA    7550    13746   .       -       .       ID=transcript:HCON_00095840;Parent=gene:HCON_00095840;Name=HCON_00095840;info=
method:InterPro accession:IPR002189 description:F-actin-capping protein subunit alpha %0Amethod:InterPro accession:IPR017865 description:F-actin capping protein%2C alpha subunit%2C conserved
 site %0Amethod:InterPro accession:IPR037282 description:F-actin-capping protein subunit alpha/beta
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    13455   13746   .       -       .       ID=exon:HCON_00095840.1;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    13259   13384   .       -       .       ID=exon:HCON_00095840.2;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    11972   12133   .       -       .       ID=exon:HCON_00095840.3;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    11792   11910   .       -       .       ID=exon:HCON_00095840.4;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    11614   11701   .       -       .       ID=exon:HCON_00095840.5;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    11474   11545   .       -       .       ID=exon:HCON_00095840.6;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    11353   11418   .       -       .       ID=exon:HCON_00095840.7;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    8221    8319    .       -       .       ID=exon:HCON_00095840.8;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       exon    7550    8072    .       -       .       ID=exon:HCON_00095840.9;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       five_prime_UTR  13545   13746   .       -       .       Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     13455   13544   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     13259   13384   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     11972   12133   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     11792   11910   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     11614   11701   .       -       1       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     11474   11545   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     11353   11418   .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     8221    8319    .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       CDS     8031    8072    .       -       0       ID=cds:HCON_00095840;Parent=transcript:HCON_00095840
hcontortus_chr4_Celeg_TT_arrow_pilon    WormBase_imported       three_prime_UTR 7550    8030    .       -       .       Parent=transcript:HCON_00095840



# First extract the CDS lines only. 
# To get just the first transcript (.1). Note that the .gff3 file has the gene name alone if a single transcript, or with a .1 or .2 etc if more than one transcript.
# Note that will need the same number of '.' as numbers in a gene name, with one extra!!

find . -name "haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3" | xargs grep -E 'CDS' | grep -v 'ID=cds:HCON_.........[2-9]' > CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3

# Get:
1       AUGUSTUS        CDS     26045   26092   1       +       0       ID=g1.t1.CDS1;Parent=g1.t1
1       AUGUSTUS        CDS     31478   31547   1       +       0       ID=g1.t1.CDS2;Parent=g1.t1
1       AUGUSTUS        CDS     32624   32743   1       +       2       ID=g1.t1.CDS3;Parent=g1.t1
1       AUGUSTUS        CDS     33344   33471   1       +       2       ID=g1.t1.CDS4;Parent=g1.t1
1       AUGUSTUS        CDS     34932   42323   0.81    -       0       ID=g2.t1.CDS1;Parent=g2.t1

# Therefore, to determine length of CDS do:

awk '{print $1 "\t" $3 "\t" $4 "\t" $5 "\t" $9 "\t" ($5 - $4) }' CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3 > length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3

# Get:
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     385466  385552  ID=cds:HCON_00096110;Parent=transcript:HCON_00096110    86
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     385613  385722  ID=cds:HCON_00096110;Parent=transcript:HCON_00096110    109
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     386728  386806  ID=cds:HCON_00096110;Parent=transcript:HCON_00096110    78
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     397197  397205  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        8
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     397005  397124  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        119
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     396590  396658  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        68
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     396385  396471  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        86
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     396232  396324  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        92
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     396084  396149  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        65
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     395918  396018  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        100
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     392795  392897  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        102
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     392477  392575  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        98
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     392180  392416  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        236
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     391160  391315  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        155
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     390960  391106  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        146
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     390783  390908  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        125
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     390600  390722  ID=cds:HCON_00096120.1;Parent=transcript:HCON_00096120.1        122
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     421861  423486  ID=cds:HCON_00096130;Parent=transcript:HCON_00096130    1625
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     423693  424364  ID=cds:HCON_00096140;Parent=transcript:HCON_00096140    671
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     424505  425713  ID=cds:HCON_00096150;Parent=transcript:HCON_00096150    1208
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     426378  427817  ID=cds:HCON_00096160;Parent=transcript:HCON_00096160    1439
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     428008  428325  ID=cds:HCON_00096170;Parent=transcript:HCON_00096170    317
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     444393  444518  ID=cds:HCON_00096180.1;Parent=transcript:HCON_00096180.1        125
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     444641  444772  ID=cds:HCON_00096180.1;Parent=transcript:HCON_00096180.1        131
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     444830  444928  ID=cds:HCON_00096180.1;Parent=transcript:HCON_00096180.1        98
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     445007  445105  ID=cds:HCON_00096180.1;Parent=transcript:HCON_00096180.1        98
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     445426  445566  ID=cds:HCON_00096180.1;Parent=transcript:HCON_00096180.1        140
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     446120  446234  ID=cds:HCON_00096190;Parent=transcript:HCON_00096190    114
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     446737  446809  ID=cds:HCON_00096190;Parent=transcript:HCON_00096190    72
hcontortus_chr4_Celeg_TT_arrow_pilon    CDS     446878  446973  ID=cds:HCON_00096190;Parent=transcript:HCON_00096190    95


# To get the gene number/name:
## Need to figure out how to remove all but the gene name..... 
# The first removes all but the gene name for genes with multiple transcripts, the second for genes with just one transcript.

sed 's/ID=cds:HCON_..........;Parent=transcript://g' length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3 > Hcon_gene_name 
sed 's/ID=cds:HCON_........;Parent=transcript://g' Hcon_gene_name > gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3

# So now have the length of each exon in nucleotides. And the gene name for each gene associated with each exon. 

# Now I want to sum the length of each gene.
# Note, the following produces an array using the values in column 5 (the gene name) and summing the values in column 6 (the exon lengths). It also counts the number of exons and the output file contains: Gene name "\t" CDS length "\t" Total number of exons. 


awk -F "\t" '{a[$5] += $6; ++c[$5]} END{for (i in a) print i, a[i], c[i]}' gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3 > SUM.gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3


# The -F is the field separator. 

# Get:

HCON_00085240 473 1
HCON_00117360 371 1
HCON_00054120 694 8
HCON_00078080 3052 26
HCON_00073910 3070 29
HCON_00023000 841 2
HCON_00162390 1696 14
HCON_00131270 906 3
HCON_00129990 825 6
HCON_00097870 687 3

#Note, for some reason genes are not in same order as in the .gff3 file, but checked and seem to be ok with the answers!  

# However, need to get so that can make into a .bed file!! 
# Need to get the first column to be just the chromosome to make into a .bed file

sed 's/hcontortus_chr//g' gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.gff3 > Hcon_chr_1 

sed 's/_Celeg_TT_arrow_pilon//g' Hcon_chr_1 > Hcon_chr_2

# Get:

4       CDS     13455   13544   HCON_00095840   89
4       CDS     13259   13384   HCON_00095840   125
4       CDS     11972   12133   HCON_00095840   161
4       CDS     11792   11910   HCON_00095840   118
4       CDS     11614   11701   HCON_00095840   87
4       CDS     11474   11545   HCON_00095840   71

# To get to right format do:

awk '{print $1 "\t" $3 "\t" $4 "\t" $2 "\t" $5 "\t" $6}' Hcon_chr_2  > gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.bed


# Got sent an mpileup file of the XQTL parents from Dr. S. Doyle (WSI). Note that UGA is first, ISE is second. Note that are sequenced from pools of 200 L3. 

# Format: Chr, bp, ref nuc, #reads covering site, Read base relative to reference, Read base quality. 

hcontortus_chr1_Celeg_TT_arrow_pilon    9       c       0       *       *       1       ^!.     /
hcontortus_chr1_Celeg_TT_arrow_pilon    10      t       0       *       *       1       .       <
hcontortus_chr1_Celeg_TT_arrow_pilon    11      a       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    12      a       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    13      g       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    14      c       0       *       *       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    15      c       0       *       *       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    16      t       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    17      a       1       ^!.     B       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    18      a       1       .       B       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    19      g       1       .       B       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    20      c       1       .       B       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    21      c       1       .       B       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    22      t       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    23      a       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    24      a       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    25      g       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    26      c       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    27      c       1       .       F       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    28      t       2       .^*.    FB      1       .       <
hcontortus_chr1_Celeg_TT_arrow_pilon    29      a       2       ..      FB      1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    30      a       2       ..      FB      1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    31      g       2       ..      FB      1       .       F


# To calculate the mean read depth per site do:

awk 'BEGIN{sum=0; counter=-1}{sum+=$4; counter+=1}END{print sum/counter}' XQTL_PARENTS.mpileup > mean.1.XQTL_PARENTS.mpileup
# 77.3105
# UGA

awk 'BEGIN{sum=0; counter=-1}{sum+=$7; counter+=1}END{print sum/counter}' XQTL_PARENTS.mpileup > mean.2.XQTL_PARENTS.mpileup
# 83.6348
# ISE

# To make into a .bed file to extract the CDS:

awk '{print $1 "\t" $2 "\t" ($2+1) "\t" $3 "\t" $4 "\t" $5 "\t" $6 "\t" $7 "\t" $8 "\t" $9}' XQTL_PARENTS.mpileup > bp2_XQTL_PARENTS.mpileup


# Get:

-bash-3.2$ more bp2_XQTL_PARENTS.mpileup
hcontortus_chr1_Celeg_TT_arrow_pilon    9       10      c       0       *       *       1       ^!.     /
hcontortus_chr1_Celeg_TT_arrow_pilon    10      11      t       0       *       *       1       .       <
hcontortus_chr1_Celeg_TT_arrow_pilon    11      12      a       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    12      13      a       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    13      14      g       0       *       *       1       .       B
hcontortus_chr1_Celeg_TT_arrow_pilon    14      15      c       0       *       *       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    15      16      c       0       *       *       1       .       F
hcontortus_chr1_Celeg_TT_arrow_pilon    16      17      t       0       *       *       1       .       B

# To make into a bed file:

sed 's/hcontortus_chr//g' bp2_XQTL_PARENTS.mpileup > Hcon_chr_1 

sed 's/_Celeg_TT_arrow_pilon//g' Hcon_chr_1 > bp2_XQTL_PARENTS.bed

# To get only those sites that I am interested in: 

bedtools intersect -a bp2_XQTL_PARENTS.bed -b gene.length.CDS.T1.haemonchus_contortus.PRJEB506.WBPS14.annotations.bed -wa -wb -f 2E-9 > CDS_bp2_XQTL_PARENTS.bed

# Get: 

1       5835    5836    T       71      ,$..,,..,.,.....,..,,,,.....,......,..,.,,.....,,,,......,,,.,,,,.,..,^],^],    BBFBFFFFFFFFkFFBFFFFFFFFFFFFFFFFFF
FFFFFFFFFFFFFFF/FFFFFFFFFFFFFF<FBBF<E   113     .$,..,.,.,......,..,,,,,....,........,.,,,,.,......,..,.,.,..,.,,..,,.,,..,,,...,....,.,....,.,,..,.,,,.,.
,,,...,^],      CBFFBFBF/FFFFFFFFFBFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFFFFFFFFFBFFFFFFFFFFFFFFFFFFFFFFFFBFFFB/FFFFFFFFFFFFFFFFFFFBFFBFE       1       5835    59
46      CDS     HCON_00000010   111
1       5836    5837    A       71      .$.,,..,.,.....,..,,,,.....,......,..,.,,.....,,,,......,,,.,,,,.,..,,,^],      7FBBFFBFFFFkFFFFFFFFFFBFFFFFFFFFFF
FFFFFFFFFFFFFF/FFFFBBFFFFBFF/<FFBFFBB   112     ,$..,.,.,......,..,,,,,....,........,.,,,,.,......,..,.,.,..,.,,..,,.,,..,,,...,....,.,....,.,,..,.,,,.,.,
,,...,, BFFBFBFFFFFFFFFFFFFFFFFFFBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFFFFFFFFFFFFFFFFFBFFFF<FFFFFFFFFFFFFFFFFFFFFFFF<        1       5835    5946    CD
S       HCON_00000010   111
1       5837    5838    T       71      .,,..,.,.....,..,,,,.....,......,..,.,,.....,,,,......,,,.,,,,.,..,,,,^],       FBBFFBFFFFkFFFFFFFFFF/FFFFBFFFFFF/
FFFFFFFFFFFF</FFFFFFFFFFFFFFFBFFFFFFE   115     .$.,.,.,......,..,,,,,....,........,.,,,,.,......,..,.,.,..,.,,..,,.,,..,,,...,....,.,....,.,,..,.,,,.,.,,
,...,,^f.^].^].^],      EFBFBFFFFFFFFBFFFFFFFFFFFFFFFFFFFFFBFFFFFFF<FFFFBFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFFBFFFB<BE     1       58
35      5946    CDS     HCON_00000010   111

# To change this back into an mpileup file for popoolation2:
# Note, am removing the gene file info and ALSO the second bp column!! 

awk '{print $1 "\t" $2 "\t" $4 "\t" $5 "\t" $6 "\t" $7 "\t" $8 "\t" $9 "\t" $10}' CDS_bp2_XQTL_PARENTS.bed > CDS_XQTL_PARENTS.mpileup

# To make the mpileup file in the correct format for PoPoolation2:

sed 's/\t\t/\t!\t!/g' CDS_XQTL_PARENTS.mpileup > CDS_XQTL_PARENTS.mpileup2

# For the following steps use PoPoolation2 (Kofler et al., 2011b). 
# To identify indels of 2 basepairs or greater:

perl  /export/home/jmi45g/popoolation2_1201/indel_filtering/identify-indel-regions.pl \
--indel-window 5 \
--min-count 2 \
--input CDS_XQTL_PARENTS.mpileup2 \
--output CDS_XQTL_PARENTS.mpileup2.indels.gtf

# To sync the filtered mpileup file (discarding low quality bases):

java -ea -Xmx7g -jar /export/home/jmi45g/popoolation2_1201/mpileup2sync.jar \
--input CDS_XQTL_PARENTS.mpileup2 \
--output CDS_XQTL_PARENTS.java.sync \
--fastq-type sanger \
--min-qual 20 \
--threads 8

# To then filter the basepairs around the indels (as these can have false SNPs due to poor alignment of reads in these positions (Schlotterer et al., 2014) - an alternative is to re-align the reads, as GATK does):

perl /export/home/jmi45g/popoolation2_1201/indel_filtering/filter-sync-by-gtf.pl \
--input CDS_XQTL_PARENTS.java.sync \
--gtf CDS_XQTL_PARENTS.mpileup2.indels.gtf \
--output CDS_XQTL_PARENTS.noindels.mpileup.sync


# Allele frequencies, Fst values, Fishers Exact Tests and conversion of output
# files into IGV format.

# To calculate allele counts within populations and allele frequency differences 
# between populations:

perl /export/home/jmi45g/popoolation2_1201/snp-frequency-diff.pl \
--input CDS_XQTL_PARENTS.noindels.mpileup.sync \
--output-prefix CDS_XQTL_PARENTS. \
--min-count 4 \
--min-coverage 10 \
--max-coverage 2%

Result: '--max-coverage 2%' is equivalent to '--max-coverage 185,177'



##chr   pos     rc      allele_count    allele_states   deletion_sum    snp_type        major_alleles(maa)      minor_alleles(mia)      maa_1   maa_2
        mia_1   mia_2
1       5851    A       2       A/G     0       pop     AA      GG      57/65   100/102 8/65    2/102
1       5910    T       2       T/A     0       pop     TT      NA      86/86   86/106  0/86    20/106
1       5916    A       2       A/T     0       pop     AA      TN      76/80   108/108 4/80    0/108
1       5921    C       2       C/T     0       pop     CC      TG      74/83   114/115 9/83    1/115
1       5930    C       2       C/T     0       pop     CC      NT      83/83   104/109 0/83    5/109
1       6016    T       2       T/C     0       pop     TT      CC      77/83   91/96   6/83    5/96
1       6022    A       2       A/G     0       pop     AA      GG      75/82   94/98   7/82    4/98
1       6031    A       2       A/G     0       pop     AA      GG      40/76   56/87   36/76   31/87
1       6040    G       2       G/A     0       pop     GG      AA      68/71   91/92   3/71    1/92
1       6049    T       2       T/A     0       pop     TT      AA      73/75   87/89   2/75    2/89
1       6216    T       2       T/C     0       pop     TT      CC      45/86   55/87   41/86   32/87
1       6218    C       2       C/T     0       pop     CC      TT      76/85   85/87   9/85    2/87
1       6224    G       2       G/A     0       pop     GG      AA      79/88   86/89   9/88    3/89
1       6230    C       2       C/T     0       pop     CC      TT      74/83   83/86   9/83    3/86
1       6245    C       2       C/T     0       pop     CC      AT      79/82   86/90   2/82    4/90
1       6277    C       2       C/T     0       pop     CC      TT      79/88   96/100  9/88    4/100
1       6287    C       2       C/T     0       pop     CC      NT      86/86   96/100  0/86    4/100
1       6288    A       2       A/G     0       pop     AA      GN      84/90   104/104 6/90    0/104
1       6885    T       2       C/T     0       rc|pop  CC      TT      59/70   90/95   11/70   5/95


# To get only biallelic SNPs:

awk '$4 == 2' CDS_XQTL_PARENTS._rc > biallelic_CDS_XQTL_PARENTS._rc

# In R v3.1.2:
# The file won't load as has missing elements per line... 
# So to load adding this to the code: sep="\t", na.strings=""

af<-read.table("biallelic_CDS_XQTL_PARENTS._rc", header=F, sep="\t", na.strings="")
summary(af)


# To make the major allele frequencies numerical and not factors...

# So, first:
af$<-as.character(af$V1)
af$V1<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V1, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V1, perl=T) ) 

af$V6<-as.character(af$V6)
af$V6<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V6, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V6, perl=T) ) 

af$V2<-as.character(af$V2)
af$V2<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V2, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V2, perl=T) ) 

af$V3<-as.character(af$V3)
af$V3<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V3, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V3, perl=T) ) 

af$V4<-as.character(af$V4)
af$V4<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V4, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V4, perl=T) ) 

af$V5<-as.character(af$V5)
af$V5<-as.numeric( gsub("(\\d+)/(\\d+)", "\\1", af$V5, perl=T) ) / as.numeric ( gsub("(\\d+)/(\\d+)", "\\2", af$V5, perl=T) ) 

summary(af)

# To put headers on the columns....

af$"Farm_2:Pre-Tx"<-af$V1
af$"Farm_2:Post-IVM"<-af$V2

af$"Farm_3:Pre-IVM:Rep_A"<-af$V3
af$"Farm_3:Pre-IVM:Rep_B"<-af$V4

af$"Farm_3:Post-IVM:Rep_A"<-af$V5
af$"Farm_3:Post-IVM:Rep_B"<-af$V6

af_b<-af
af<-af_b[7:12]

